<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>HIK Store</title>
<link rel="icon" href="logo.png" type="image/png"> 
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
*{margin:0;padding:0;box-sizing:border-box;}
html {scroll-behavior: smooth;}
body{
    font-family:'Montserrat',sans-serif;
    background:#f0f2f5;
    overflow-x:hidden;
}
a, button, .cart, #toggleSidebarBtn, #modalMainImgContainer {cursor: pointer;}

#bgLayer{position:absolute;top:0;left:0;width:100%;height:100%;z-index:-1;pointer-events:none;}
.bubble{position:absolute;border-radius:50%;background:rgba(0,114,255,0.15);animation:bubbleMove 25s linear infinite;mix-blend-mode:screen;filter:blur(15px);}
@keyframes bubbleMove{0%{transform:translateY(0);}100%{transform:translateY(-1200px);}}

#topBar{position:fixed;top:0;left:0;width:100%;height:60px;background:rgba(255,255,255,0.95);backdrop-filter:blur(25px);display:flex;align-items:center;justify-content:space-between;padding:0 25px;z-index:15;box-shadow:0 5px 25px rgba(0,0,0,0.1);transition:.3s;}
.leftZone{display:flex;align-items:center;gap:18px;}
#toggleSidebarBtn{width:28px;height:22px;cursor:pointer;display:flex;flex-direction:column;justify-content:space-between;}
#toggleSidebarBtn div{height:3px;background:#0072ff;border-radius:2px;transition:.3s;}
#toggleSidebarBtn.open div:nth-child(1){transform:translateY(9px) rotate(45deg);}
#toggleSidebarBtn.open div:nth-child(2){opacity:0;}
#toggleSidebarBtn.open div:nth-child(3){transform:translateY(-9px) rotate(-45deg);}
.logoWrap{display:flex;align-items:center;gap:10px;font-weight:800;color:#0072ff;font-size:20px;}
.logoWrap img {height:42px;width:auto;object-fit:contain;}
.search{flex:1;margin:0 20px;display:flex;}
.search input{flex:1;padding:8px 14px;border-radius:25px;border:1px solid #ccc;font-size:14px;transition:.2s;}
.search button{padding:8px 16px;margin-left:8px;border-radius:25px;border:none;background:#0072ff;color:#fff;cursor:pointer;transition:.2s;box-shadow:0 0 12px #0072ff;}
.search button:hover{background:#005bb5;}
.cart{font-size:22px;color:#0072ff;position:relative;cursor:pointer;}
.cart span{position:absolute;top:-8px;right:-8px;background:red;color:white;font-size:12px;padding:2px 6px;border-radius:50%;font-weight:700;transition:.15s;}

#sidebar{position:fixed;left:0;top:60px;width:220px;height:calc(100% - 60px);background:rgba(255,255,255,.8);backdrop-filter:blur(40px) saturate(180%);padding-top:20px;border-right:1px solid rgba(0,0,0,.1);z-index:10;overflow:auto;transition:.25s;}
#sidebar.collapsed{transform:translateX(-240px);}
#sidebar a{display:flex;align-items:center;padding:12px 20px;text-decoration:none;color:#000;font-weight:600;transition:.18s;}
#sidebar a:hover{color:#0072ff;}

.banner{width:100%;overflow:hidden;background:linear-gradient(90deg,#0072ff,#00c6ff);color:#fff;font-weight:800;font-size:18px;text-align:left;white-space:nowrap;padding:12px 0;margin-top:60px;border-radius:0 0 12px 12px;}
.banner span{display:inline-block;padding-left:100%;animation:slide 18s linear infinite;}
@keyframes slide{0%{transform:translateX(0);}100%{transform:translateX(-100%);}}

main{margin-left:220px;padding-top:25px;transition:.25s;}
main.collapsed{margin-left:0;}
.section{padding:60px 5vw;text-align:center;}
.section:nth-child(even){background:#f9fbfd;border-radius:12px;margin:12px 0;}
.section h2{font-size:30px;color:#222;margin-bottom:16px;font-weight:800;}

.trust-badges {display:flex;justify-content:center;gap:40px;margin:40px 0;flex-wrap:wrap;}
.trust-badge {display:flex;align-items:center;gap:10px;font-weight:600;color:#555;}
.trust-badge i {color:#0072ff;font-size:1.2em;}

.product-features {display:grid;grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));gap:20px;margin:30px 0;}
.feature {text-align:center;padding:20px;}
.feature i {font-size:2.5em;color:#0072ff;margin-bottom:15px;}
.feature h3 {margin-bottom:10px;color:#333;}

.testimonials {background:linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);padding:60px 5vw;}
.testimonial-grid {display:grid;grid-template-columns:repeat(auto-fit, minmax(300px, 1fr));gap:30px;margin-top:40px;}
.testimonial {background:white;padding:30px;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,0.1);}
.testimonial-content {font-style:italic;margin-bottom:20px;color:#555;}
.testimonial-author {display:flex;align-items:center;gap:15px;}
.author-info h4 {margin:0;color:#333;}
.author-info p {margin:0;color:#666;font-size:0.9em;}

.grid{display:grid;grid-template-columns:repeat(auto-fit, minmax(220px, 1fr));gap:22px;overflow-x:hidden;padding-bottom:10px;scroll-behavior:smooth;justify-content:start;}
.card{background:rgba(255,255,255,.45);backdrop-filter:blur(40px) saturate(200%);border-radius:14px;padding:12px;display:flex;flex-direction:column;align-items:center;position:relative;transition:.25s;box-shadow:0 10px 30px rgba(0,0,0,.08);}
.card:hover{transform:translateY(-6px) scale(1.02);box-shadow:0 14px 40px rgba(0,0,0,.12);}
.thumb{width:100%;height:150px;border-radius:10px;overflow:hidden;cursor:pointer;display:flex;align-items:center;justify-content:center;background-color:#f8f8f8;}
.thumb img{max-width:100%;max-height:100%;object-fit:contain;transition:.3s;}
.thumb img:hover{transform:scale(1.05);}
.title{margin-top:10px;font-weight:700;color:#222;text-align:center;font-size:15px;}
.price{margin-top:6px;font-weight:700;color:#0072ff;text-align:center;font-size:14px;}
button{margin-top:10px;padding:8px 14px;border:none;border-radius:12px;background:#0072ff;color:#fff;cursor:pointer;font-weight:700;transition:.2s;box-shadow:0 4px 15px #0072ff80;font-size:14px;}
button:hover{background:#005bb5;transform:scale(1.04);box-shadow:0 0 15px #0072ffaa;}
.hot-badge{position:absolute;top:10px;left:10px;background:red;color:white;font-size:12px;padding:4px 10px;border-radius:12px;font-weight:700;box-shadow:0 0 10px rgba(0,0,0,0.15);}

#cartGrid .remove-btn{position:absolute;top:10px;right:10px;background:#ff4d4f;width:28px;height:28px;border-radius:50%;color:#fff;display:flex;align-items:center;justify-content:center;font-weight:bold;}
#cartGrid .remove-btn:hover{background:#c41d1d;transform:scale(1.15);}

.contact a{display:inline-block;margin:8px 14px;padding:10px 18px;background:rgba(255,255,255,.6);border-radius:18px;backdrop-filter:blur(40px);text-decoration:none;color:#000;font-weight:700;transition:.18s;font-size:14px;}
.contact a:hover{transform:scale(1.04);background:rgba(255,255,255,.8);}

.categories button{margin:10px 16px;padding:10px 20px;border-radius:25px;border:1px solid #0072ff;background:#fff;color:#0072ff;font-weight:700;cursor:pointer;transition:.18s;font-size:14px;}
.categories button:hover, .categories button.active{background:#0072ff;color:#fff;transform:scale(1.04);}

#productModal{position:fixed;top:0;left:0;width:100%;height:100%;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.55);backdrop-filter:blur(8px);z-index:9999;padding:20px;}
#productModal .wrap{background:#fff;border-radius:14px;padding:20px;width:100%;max-width:1000px;display:flex;gap:20px;position:relative;box-shadow:0 15px 40px rgba(0,0,0,0.25);}
#productModal #closeModal{position:absolute;top:12px;right:16px;font-size:26px;cursor:pointer;}
#modalThumbs img{width:72px;height:72px;border-radius:8px;object-fit:contain;cursor:pointer;border:2px solid transparent;background-color:#f8f8f8;}
#modalThumbs img:hover{border-color:#0072ff;transform:scale(1.05);}
@media (max-width:900px){#productModal .wrap{flex-direction:column;} .thumb{height:220px}}

#modalMainImgContainer {width:100%;height:360px;border-radius:10px;overflow:hidden;position:relative;cursor:zoom-in;display:flex;align-items:center;justify-content:center;background-color:#f8f8f8;}
#modalMainImg {max-width:100%;max-height:100%;object-fit:contain;transition:transform 0.1s ease-out;transform-origin:center center;}

#aiWidget{position:fixed;bottom:20px;right:20px;width:64px;height:64px;border-radius:16px;background:#0072ff;color:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:9999;box-shadow:0 12px 30px rgba(0,0,0,0.18);}
#aiPanel{position:fixed;bottom:100px;right:20px;width:340px;max-height:60vh;background:#fff;border-radius:12px;box-shadow:0 20px 50px rgba(0,0,0,0.2);display:none;flex-direction:column;overflow:hidden;z-index:9999;}
#aiPanel header{background:linear-gradient(90deg,#0072ff,#00c6ff);color:#fff;padding:12px;font-weight:800;}
#aiPanel .messages{padding:12px;flex:1;overflow:auto;}
.ai-msg{margin-bottom:10px;padding:8px 10px;border-radius:10px;max-width:85%;line-height:1.4;}
.ai-msg.me{background:#e8f0ff;margin-left:auto;}
.ai-msg.bot{background:#f3f3f3;}
#aiPanel footer{display:flex;padding:10px;gap:8px;border-top:1px solid #eee;}
#aiPanel input{flex:1;padding:8px;border-radius:8px;border:1px solid #ddd;}
#aiPanel button{padding:8px 10px;border-radius:8px;background:#0072ff;color:#fff;border:none;cursor:pointer;}

.checkout-container {max-width:500px;margin:auto;padding:25px;border:1px solid #e0e0e0;border-radius:12px;background:white;text-align:left;box-shadow:0 10px 30px rgba(0,0,0,0.08);}
.checkout-container label {display:block;margin-bottom:5px;font-weight:700;color:#333;font-size:14px;}
.checkout-container input[type="text"],.checkout-container input[type="email"],.checkout-container input[type="number"],.checkout-container input[type="tel"],.checkout-container textarea {width:100%;padding:10px;margin-bottom:15px;border:1px solid #ccc;border-radius:6px;box-sizing:border-box;}
.checkout-container button[type="submit"] {background-color:#28a745;color:white;padding:12px 18px;border:none;border-radius:8px;cursor:pointer;font-size:16px;font-weight:700;box-shadow:0 4px 15px rgba(40,167,69,0.4);}
.checkout-container button[type="submit"]:hover {background-color:#1e7e34;}
.checkout-container #backToCartBtn {background:#6c757d !important;color:#fff !important;box-shadow:none !important;margin-left:10px;padding:12px 18px;}
.checkout-container #backToCartBtn:hover {background:#5a6268 !important;}

#paymentFeedback {margin-top:20px;padding:15px;border-radius:8px;font-weight:700;text-align:center;display:none;line-height:1.4;}
.success {background-color:#d4edda;color:#155724;border:1px solid #c3e6cb;}
.error {background-color:#f8d7da;color:#721c24;border:1px solid #f5c6cb;}

.fallback-message {background:#fff3cd;border:1px solid #ffeaa7;color:#856404;padding:15px;border-radius:8px;margin-top:15px;font-size:14px;}

#notification {position:fixed;top:0px;left:50%;transform:translateX(-50%);background-color:#0072ff;color:white;padding:12px 25px;border-radius:0 0 10px 10px;box-shadow:0 4px 15px rgba(0,0,0,0.2);font-weight:600;font-size:16px;opacity:0;visibility:hidden;transition:all 0.5s ease-out;z-index:10000;display:flex;align-items:center;gap:10px;}
#notification.show {top:60px;opacity:1;visibility:visible;}

.hidden {display:none !important;}
</style>
</head>
<body>

<div id="bgLayer"></div>

<div id="notification">
    <i class="fas fa-check-circle"></i> Item added to cart!
</div>

<div id="topBar">
  <div class="leftZone">
    <div id="toggleSidebarBtn"><div></div><div></div><div></div></div>
    <div class="logoWrap" title="HIK Store">
      <img src="logo.png" alt="HIK Store Logo"> 
    </div>
  </div>
  <div class="search"><input id="searchInput" type="text" placeholder="Search products..."><button id="searchBtn">Search</button></div>
  <div class="cart" id="cartBtn"><i class="fas fa-shopping-cart"></i><span id="cartCount">0</span></div>
</div>

<div id="sidebar">
  <a href="#products" class="nav-link"><i class="fas fa-box-open" style="width:20px;text-align:center"></i> Products</a>
  <a href="#featuredOffers" class="nav-link"><i class="fas fa-star" style="width:20px;text-align:center"></i> Featured Offers</a>
  <a href="#categories" class="nav-link"><i class="fas fa-th-large" style="width:20px;text-align:center"></i> Categories</a>
  <a href="#testimonials" class="nav-link"><i class="fas fa-comment" style="width:20px;text-align:center"></i> Testimonials</a>
  <a href="#cart" class="nav-link"><i class="fas fa-shopping-cart" style="width:20px;text-align:center"></i> Cart</a>
  <a href="#contact" class="nav-link"><i class="fas fa-phone" style="width:20px;text-align:center"></i> Contact</a>
</div>

<div class="banner"><span>üî• **MAINTENANCE COMPLETE** - We're back! 50% OFF on select items! Limited time only! üî•</span></div>

<main id="mainContent">
  <div class="trust-badges">
    <div class="trust-badge"><i class="fas fa-shipping-fast"></i><span>Fast Delivery</span></div>
    <div class="trust-badge"><i class="fas fa-certificate"></i><span>Authentic Products</span></div>
    <div class="trust-badge"><i class="fas fa-lock"></i><span>Secure Payment</span></div>
    <div class="trust-badge"><i class="fas fa-tags"></i><span>Best Prices</span></div>
  </div>

  <section class="section">
    <h2>Why Choose HIK Store?</h2>
    <div class="product-features">
      <div class="feature"><i class="fas fa-shipping-fast"></i><h3>Fast Delivery</h3><p>Same-day delivery available in Dubai & Abu Dhabi</p></div>
      <div class="feature"><i class="fas fa-certificate"></i><h3>Authentic Products</h3><p>100% genuine products with manufacturer warranty</p></div>
      <div class="feature"><i class="fas fa-lock"></i><h3>Secure Payment</h3><p>SSL encrypted payments for your safety</p></div>
      <div class="feature"><i class="fas fa-tags"></i><h3>Best Prices</h3><p>Price match guarantee on all products</p></div>
    </div>
  </section>

  <section class="section" id="products">
    <h2 id="products-title">All Products (50 Items)</h2>
    <div class="grid" id="productGrid"></div>
  </section>

  <section class="section" id="featuredOffers">
    <h2>Featured Offers (Top 10 Deals)</h2>
    <div class="grid" id="featuredGrid"></div>
  </section>

  <section class="section categories" id="categories">
    <h2>Categories</h2>
    <button class="category-btn" onclick="filterProducts('All')">All</button>
    <button class="category-btn" onclick="filterProducts('Electronics')">Electronics</button>
    <button class="category-btn" onclick="filterProducts('Clothing')">Clothing</button>
    <button class="category-btn" onclick="filterProducts('Home & Kitchen')">Home & Kitchen</button>
    <button class="category-btn" onclick="filterProducts('Gaming')">Gaming</button>
    <button class="category-btn" onclick="filterProducts('Books')">Books</button>
  </section>

  <section class="section testimonials" id="testimonials">
    <h2>What Our Customers Say</h2>
    <div class="testimonial-grid">
      <div class="testimonial">
        <div class="testimonial-content">"Amazing service! My VR headset arrived the same day. The quality is outstanding and the price was unbeatable."</div>
        <div class="testimonial-author">
          <div class="author-avatar" style="width:50px;height:50px;border-radius:50%;background:#0072ff;display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;">SM</div>
          <div class="author-info"><h4>Sarah M.</h4><p>Dubai</p></div>
        </div>
      </div>
      <div class="testimonial">
        <div class="testimonial-content">"Best electronics store in UAE. Their customer support helped me choose the perfect laptop for my needs."</div>
        <div class="testimonial-author">
          <div class="author-avatar" style="width:50px;height:50px;border-radius:50%;background:#28a745;display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;">AR</div>
          <div class="author-info"><h4>Ahmed R.</h4><p>Abu Dhabi</p></div>
        </div>
      </div>
      <div class="testimonial">
        <div class="testimonial-content">"Fast shipping and genuine products. I've purchased multiple gadgets and always had a great experience."</div>
        <div class="testimonial-author">
          <div class="author-avatar" style="width:50px;height:50px;border-radius:50%;background:#dc3545;display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;">LK</div>
          <div class="author-info"><h4>Lina K.</h4><p>Sharjah</p></div>
        </div>
      </div>
    </div>
  </section>

  <section class="section" id="cart">
    <h2>Your Cart</h2>
    <div class="grid" id="cartGrid"></div>
    <div style="margin-top:12px;font-size:20px;font-weight:800;">Total: AED <span id="cartTotal">0.00</span></div>
    <div id="checkoutRow">
      <button id="goToCheckoutBtn" style="background:#0072ff;color:#fff;padding:12px 24px;border-radius:12px;border:none;cursor:pointer;font-weight:800;box-shadow:0 6px 20px rgba(0,0,0,0.12);margin-top:12px;">Proceed to Checkout</button>
    </div>
  </section>

  <section class="section" id="checkoutPage" style="background:none;display:none;">
    <h2>Complete Your Purchase</h2>
    <div class="checkout-container">
      <!-- WEB3FORMS INTEGRATION -->
      <form id="paymentForm" action="https://api.web3forms.com/submit" method="POST">
        <!-- REPLACE THIS WITH YOUR ACTUAL WEB3FORMS ACCESS KEY -->
        <input type="hidden" name="access_key" value="ce841447-3e77-452b-a334-14ede39df8ef">
        <input type="hidden" name="subject" value="New Order - HIK Store">
        <input type="hidden" name="from_name" value="HIK Store Website">
        <input type="hidden" name="botcheck" value="">
        
        <!-- Order details that will be sent to email -->
        <input type="hidden" name="order_total" id="web3OrderTotal" value="">
        <input type="hidden" name="order_items" id="web3OrderItems" value="">
        <input type="hidden" name="order_details" id="web3OrderDetails" value="">
        
        <label for="name">Full Name:</label>
        <input type="text" id="name" name="name" required>

        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required>
        
        <label for="phone">Phone Number:</label>
        <input type="tel" id="phone" name="phone" required>

        <h3 style="margin:20px 0 10px;font-size:18px;color:#0072ff;">Shipping Address</h3>
        
        <label for="address">Street Address:</label>
        <input type="text" id="address" name="address" required>

        <label for="city">City:</label>
        <input type="text" id="city" name="city" required>

        <label for="country">Country:</label>
        <input type="text" id="country" name="country" value="UAE" required>
        
        <label for="zip">Postal Code:</label>
        <input type="text" id="zip" name="zip" required>

        <h3 style="margin:20px 0 10px;font-size:18px;color:#0072ff;">Payment Details</h3>

        <label for="cardNumber">Card Number:</label>
        <input type="text" id="cardNumber" name="card_number" pattern="[0-9]{13,16}" required>

        <label for="expiryDate">Expiry Date (MM/YY):</label>
        <input type="text" id="expiryDate" name="expiry_date" pattern="(0[1-9]|1[0-2])\/?([0-9]{2})" placeholder="MM/YY" required>

        <label for="cvv">CVV:</label>
        <input type="text" id="cvv" name="cvv" pattern="[0-9]{3,4}" required>
        
        <label for="message">Order Notes (Optional):</label>
        <textarea id="message" name="message" rows="3"></textarea>
        
        <div id="paymentFeedback" style="display:none;"></div>

        <button type="submit" id="payment-button">Confirm Order & Pay AED <span id="paymentTotal">0.00</span></button>
        <button type="button" id="backToCartBtn">Back to Cart</button>
      </form>
      
      <div style="margin-top:15px;font-size:14px;text-align:center;color:#666;">
        *Orders will be sent to your email via Web3Forms*
      </div>
    </div>
  </section>

  <section class="section contact" id="contact">
    <h2>Contact Us</h2>
    <a href="https://wa.me/0000000000" target="_blank"><i class="fab fa-whatsapp"></i> WhatsApp</a>
    <a href="#" target="_blank"><i class="fab fa-facebook"></i> Facebook</a>
    <a href="#" target="_blank"><i class="fab fa-instagram"></i> Instagram</a>
  </section>
</main>

<div id="productModal">
  <div class="wrap" role="dialog" aria-modal="true">
    <span id="closeModal">√ó</span>
    <div style="flex:1">
      <div id="modalMainImgContainer"><img id="modalMainImg" src="" alt="Product Image" /></div>
      <div id="modalThumbs" style="display:flex;gap:10px;margin-top:12px;overflow-x:auto"></div>
    </div>
    <div style="flex:1;display:flex;flex-direction:column;justify-content:center">
      <h2 id="modalTitle"></h2>
      <div id="modalPrice" style="color:#0072ff;font-weight:800;font-size:22px;margin-bottom:12px;"></div>
      <p id="modalDesc" style="margin-bottom:18px;color:#333;line-height:1.45"></p>
      <div style="display:flex;gap:12px;align-items:center">
        <button id="modalBuy" style="padding:12px 18px;font-size:16px;border-radius:12px;background:#0072ff;color:#fff;cursor:pointer;box-shadow:0 0 18px #0072ff80">Add to Cart</button>
      </div>
    </div>
  </div>
</div>

<div id="aiWidget" title="Assistant">ü§ñ</div>
<div id="aiPanel" aria-hidden="true">
  <header>HIK Assistant</header>
  <div class="messages" id="aiMessages">
    <div class="ai-msg bot">Hi! I'm the HIK Assistant. Ask me about products, shipping, returns, or your current cart total.</div>
  </div>
  <footer>
    <input id="aiInput" placeholder="Ask something..." />
    <button id="aiSend">Send</button>
  </footer>
</div>

<script>
// ... (ALL YOUR EXISTING JAVASCRIPT CODE REMAINS THE SAME UNTIL THE FORM SUBMISSION PART) ...

const sidebar = document.getElementById('sidebar');
const toggleBtn = document.getElementById('toggleSidebarBtn');
const main = document.getElementById('mainContent');
const sections = document.querySelectorAll('.section');

toggleBtn.onclick = () => { 
    sidebar.classList.toggle('collapsed'); 
    main.classList.toggle('collapsed'); 
    toggleBtn.classList.toggle('open'); 
};

document.querySelectorAll('.nav-link').forEach(link => {
    link.addEventListener('click', function(e) {
        sections.forEach(sec => { sec.style.display = 'block'; });
        document.getElementById('checkoutPage').style.display = 'none'; 
    });
});
document.getElementById('cartBtn').onclick = () => {
    sections.forEach(sec => { sec.style.display = 'block'; });
    document.getElementById('checkoutPage').style.display = 'none'; 
    document.getElementById('cart').scrollIntoView({ behavior: 'smooth' });
};

const bg = document.getElementById('bgLayer'), bArray = [];
function updateBgHeight(){ bg.style.height = document.body.scrollHeight + 'px'; }
window.addEventListener('resize', updateBgHeight);
for (let i=0;i<28;i++){ let b=document.createElement('div'); b.className='bubble'; let s=Math.random()*60+30; b.style.width=b.style.height=s+'px'; b.style.left=Math.random()*95+'vw'; b.style.top=Math.random()*document.body.scrollHeight+'px'; bg.appendChild(b); bArray.push({el:b,x:(Math.random()*0.12-0.06),y:(Math.random()*0.12-0.06)}); }
(function animateBubbles(){ 
    bArray.forEach(bu=>{ 
        let l=parseFloat(bu.el.style.left), t=parseFloat(bu.el.style.top); 
        l+=bu.x; 
        t+=bu.y; 
        if(l>95||l<0)bu.x*=-1; 
        if(t>document.body.scrollHeight||t<0)bu.y*=-1; 
        bu.el.style.left = l + 'vw'; 
        bu.el.style.top = t + 'px'; 
    }); 
    requestAnimationFrame(animateBubbles); 
})();

let cart = [];
function getCartTotalElement() { return document.getElementById('cartTotal'); }

function renderCart(){
    const cartGrid = document.getElementById('cartGrid');
    const cartCountElement = document.getElementById('cartCount');
    const cartTotalElement = document.getElementById('cartTotal');
    const paymentTotalElement = document.getElementById('paymentTotal');
    
    if (cartGrid) cartGrid.innerHTML = ''; 
    
    let total = 0;
    cart.forEach((it, idx) => {
        total += it.price;
        const d = document.createElement('div'); d.className='card';
        d.innerHTML = `<div class="title">${it.title}</div><div class="price">AED ${it.price.toFixed(2)}</div>`;
        
        if (cartGrid) {
             const btn = document.createElement('button'); btn.className='remove-btn'; btn.innerHTML='&times;';
             btn.style.position = 'absolute'; btn.style.top = '10px'; btn.style.right = '10px';
             btn.style.width = '28px'; btn.style.height = '28px'; btn.style.padding = '0';
             btn.onclick = ()=>{ cart.splice(idx,1); renderCart(); };
            d.appendChild(btn); 
            cartGrid.appendChild(d);
        }
    });
    
    if (cartCountElement) cartCountElement.innerText = cart.length;
    if (cartTotalElement) cartTotalElement.innerText = total.toFixed(2);
    if (paymentTotalElement) paymentTotalElement.innerText = total.toFixed(2); 
}

const modalImage = document.getElementById('modalMainImg');
const modalImageContainer = document.getElementById('modalMainImgContainer');

function handleZoom(e) {
    const { left, top, width, height } = modalImageContainer.getBoundingClientRect();
    const x = (e.clientX - left) / width; 
    const y = (e.clientY - top) / height; 
    const originX = x * 100;
    const originY = y * 100;
    const scaleFactor = 2.5; 
    modalImage.style.transformOrigin = `${originX}% ${originY}%`;
    modalImage.style.transform = `scale(${scaleFactor})`;
}

function resetZoom() {
    modalImage.style.transform = 'scale(1)';
    modalImage.style.transformOrigin = 'center center';
}

modalImageContainer.addEventListener('mousemove', handleZoom);
modalImageContainer.addEventListener('mouseleave', resetZoom);

const notification = document.getElementById('notification');
const notificationQueue = [];
let isShowing = false;

function processNotificationQueue() {
    if (notificationQueue.length === 0 || isShowing) return;
    isShowing = true;
    const { message, duration } = notificationQueue.shift();
    notification.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;
    notification.classList.add('show');
    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
            isShowing = false;
            processNotificationQueue();
        }, 500); 
    }, duration);
}

function showNotification(message = "Item added to cart!", duration = 2000) {
    notificationQueue.push({ message, duration });
    processNotificationQueue();
}

const modal = document.getElementById('productModal');
function openProductModal(title, price, img, desc){
    document.getElementById('modalTitle').innerText = title;
    document.getElementById('modalPrice').innerText = 'AED ' + parseFloat(price).toFixed(2);
    document.getElementById('modalMainImg').src = img; 
    document.getElementById('modalDesc').innerText = desc || 'Premium product. High quality and customer-approved.';
    resetZoom();
    
    const thumbs = document.getElementById('modalThumbs'); thumbs.innerHTML='';
    for (let i=0;i<4;i++){
        const t = document.createElement('img'); 
        t.src = img; 
        t.onclick = ()=>{ document.getElementById('modalMainImg').src = t.src; resetZoom(); };
        thumbs.appendChild(t);
    }
    
    document.getElementById('modalBuy').onclick = ()=>{ 
        const item = productData.find(p => p.title.includes(title.replace(' (HOT DEAL)', '')));
        const finalPrice = title.includes('(HOT DEAL)') ? item.price * 0.85 : item.price;
        cart.push({title: item.title, price: finalPrice}); 
        renderCart(); 
        showNotification(`${title} added to cart!`);
    };
    
    modal.style.display = 'flex';
}
document.getElementById('closeModal').onclick = ()=>{ modal.style.display='none'; };
modal.addEventListener('click', (e)=>{ if (e.target === modal) modal.style.display='none'; });

const AED_CONVERSION_RATE = 3.67; 
const productDataUSD = [
    { id:1, title: 'Meta Quest 3 512GB VR Headset', desc: 'Advanced mixed reality headset with pancake lenses and 512GB storage.', price: 649.99, imageUrl: 'product_01.jpg', category: 'Gaming' },
    { id:2, title: 'Dyson Zone Noise-Cancelling Headphones', desc: 'High-fidelity audio headphones featuring advanced noise cancellation.', price: 929.00, imageUrl: 'product_02.jpg', category: 'Electronics' },
    { id:3, title: 'Beats Studio Buds + (Transparent Edition)', desc: 'True wireless noise-cancelling earbuds with transparent casing.', price: 179.99, imageUrl: 'product_03.jpg', category: 'Electronics' },
    { id:4, title: 'Nothing Phone (2) 5G 512GB', desc: 'Unique smartphone featuring transparent Glyph Interface LED design.', price: 799.00, imageUrl: 'product_04.jpg', category: 'Electronics' },
    { id:5, title: 'GoPro HERO12 Black Action Camera', desc: 'Latest GoPro featuring 5.3K video resolution and improved stabilization.', price: 449.99, imageUrl: 'product_05.jpg', category: 'Electronics' },
    { id:6, title: 'Anker Solix F3800 Portable Power Station', desc: 'Massive capacity power station with expandable battery packs.', price: 3499.00, imageUrl: 'product_06.jpg', category: 'Electronics' },
    { id:7, title: 'Logitech G PRO X TKL LIGHTSPEED Keyboard', desc: 'Tournament-grade tenkeyless gaming keyboard with wireless technology.', price: 199.99, imageUrl: 'product_07.jpg', category: 'Gaming' },
    { id:8, title: 'Nanoleaf Lines Modular Lighting Kit (9 Pcs)', desc: 'Smart LED light bars that create geometric designs.', price: 199.00, imageUrl: 'product_08.jpg', category: 'Electronics' },
    { id:9, title: 'Kindle Scribe Premium Pen Edition', desc: 'First Kindle for reading and writing with 10.2" Paperwhite display.', price: 389.99, imageUrl: 'product_09.jpg', category: 'Books' },
    { id:10, title: 'Shure MV7X Podcast Microphone (XLR)', desc: 'Professional dynamic microphone optimized for podcasting.', price: 199.00, imageUrl: 'product_10.jpg', category: 'Electronics' },
    // ... (rest of your product data remains the same) ...
];

const productData = productDataUSD.map(p => ({...p, price: p.price * AED_CONVERSION_RATE }));

const PLACEHOLDER_IMG_FALLBACK = "https://via.placeholder.com/220x150/0072ff/ffffff?text=Image+Missing"; 

function addCard(grid, title, price, img, isHot=false, desc){
    const c = document.createElement('div'); c.className = 'card';
    c.innerHTML = `<div class="thumb"><img src="${img}" onerror="this.onerror=null;this.src='${PLACEHOLDER_IMG_FALLBACK}';" alt="${title}"></div><div class="title">${title}</div><div class="price">AED ${parseFloat(price).toFixed(2)}</div><button>Add</button>`;
    
    c.querySelector('button').onclick = ()=>{ 
        const cleanTitle = title.replace(' (HOT DEAL)', '');
        const item = productData.find(p => p.title === cleanTitle);
        const finalPrice = isHot ? item.price * 0.85 : item.price;
        cart.push({title: item.title, price: finalPrice}); 
        renderCart(); 
        showNotification(`${title} added to cart!`);
    };
    
    c.querySelector('.thumb').onclick = ()=>{ openProductModal(title, price, img, desc || 'High quality item.'); };
    if (isHot) { const hb = document.createElement('div'); hb.className='hot-badge'; hb.innerText='HOT'; c.appendChild(hb); }
    grid.appendChild(c);
}

function filterProducts(category) {
    const productGrid = document.getElementById('productGrid');
    const featuredSection = document.getElementById('featuredOffers');
    const productsTitle = document.getElementById('products-title');
    productGrid.innerHTML = '';
    
    const buttons = document.querySelectorAll('.category-btn');
    buttons.forEach(btn => btn.classList.remove('active'));
    
    let filteredData;
    
    if (category === 'All') {
        filteredData = productData;
        document.querySelector('.category-btn[onclick="filterProducts(\'All\')"]').classList.add('active');
        featuredSection.style.display = 'block';
        productsTitle.innerText = 'All Products (50 Items)';
    } else {
        filteredData = productData.filter(p => p.category === category);
        document.querySelector(`.category-btn[onclick="filterProducts('${category}')"]`).classList.add('active');
        featuredSection.style.display = 'none';
        productsTitle.innerText = category;
    }
    
    filteredData.forEach(product => {
        const isHot = productData.indexOf(product) < 10;
        const price = isHot ? product.price * 0.85 : product.price;
        const title = isHot ? product.title + ' (HOT DEAL)' : product.title;
        addCard(productGrid, title, price, product.imageUrl, isHot, product.desc);
    });
}

window.onload = () => {
    updateBgHeight();
    const productGrid = document.getElementById('productGrid');
    const featuredGrid = document.getElementById('featuredGrid');

    productData.forEach(product => {
        const isHot = productData.indexOf(product) < 10;
        const price = isHot ? product.price * 0.85 : product.price;
        const title = isHot ? product.title + ' (HOT DEAL)' : product.title;
        addCard(productGrid, title, price, product.imageUrl, isHot, product.desc);
    });

    productData.slice(0, 10).forEach(product => { 
        const hotPrice = (product.price * 0.85); 
        addCard(featuredGrid, product.title + ' (HOT DEAL)', hotPrice, product.imageUrl, true, product.desc + ' Limited time offer!');
    });
    
    document.querySelector('.category-btn[onclick="filterProducts(\'All\')"]').classList.add('active');
    renderCart();
};

let isDown=false, startX, scrollLeft;
const featuredGrid = document.getElementById('featuredGrid');
featuredGrid.addEventListener('mousedown', (e)=>{ isDown=true; startX=e.pageX - featuredGrid.offsetLeft; scrollLeft = featuredGrid.scrollLeft;});
featuredGrid.addEventListener('mouseleave', ()=>{ isDown=false; });
featuredGrid.addEventListener('mouseup', ()=>{ isDown=false; });
featuredGrid.addEventListener('mousemove', (e)=>{ if(!isDown) return; e.preventDefault(); featuredGrid.scrollLeft = scrollLeft - (e.pageX - startX) * 2; });
featuredGrid.addEventListener('touchstart', (e)=>{ startX = e.touches[0].pageX - featuredGrid.offsetLeft; scrollLeft = featuredGrid.scrollLeft; });
featuredGrid.addEventListener('touchmove', (e)=>{ featuredGrid.scrollLeft = scrollLeft - (e.touches[0].pageX - startX) * 2; });

document.getElementById('searchBtn').onclick = ()=>{
    const val = document.getElementById('searchInput').value.toLowerCase().trim();
    filterProducts('All');
    document.querySelectorAll('#productGrid .card').forEach(c=>{ 
        if (!c.querySelector('.title').innerText.toLowerCase().includes(val)) c.style.display = 'none';
        else c.style.display = 'flex';
    });
    document.getElementById('featuredOffers').style.display = 'none';
    document.getElementById('products-title').innerText = `Search results for "${val}"`;
};

document.getElementById('goToCheckoutBtn').onclick = () => {
    if (cart.length === 0) {
        showNotification("Your cart is empty! Please add items before checking out.", 3000); 
        return;
    }
    renderCart();
    
    // Prepare order data for Web3Forms
    const totalAmount = parseFloat(getCartTotalElement().innerText);
    const orderSummary = cart.map(item => `${item.title} - AED ${item.price.toFixed(2)}`).join('\n');
    const fullOrderDetails = `ORDER SUMMARY:\nTotal: AED ${totalAmount.toFixed(2)}\nItems:\n${orderSummary}`;
    
    document.getElementById('web3OrderTotal').value = `AED ${totalAmount.toFixed(2)}`;
    document.getElementById('web3OrderItems').value = cart.length;
    document.getElementById('web3OrderDetails').value = fullOrderDetails;
    
    sections.forEach(sec => { sec.style.display = 'none'; });
    document.getElementById('checkoutPage').style.display = 'block';
    document.getElementById('checkoutPage').scrollIntoView({ behavior: 'smooth' });
};

document.getElementById('backToCartBtn').onclick = () => {
    sections.forEach(sec => { sec.style.display = 'block'; });
    document.getElementById('checkoutPage').style.display = 'none';
    document.getElementById('cart').scrollIntoView({ behavior: 'smooth' });
};

// WEB3FORMS SUBMISSION - THIS WILL SEND TO YOUR EMAIL
document.getElementById('paymentForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const form = e.target;
    const totalAmount = parseFloat(getCartTotalElement().innerText);
    const feedbackDiv = document.getElementById('paymentFeedback');
    const paymentButton = document.getElementById('payment-button');

    if (cart.length === 0) {
        feedbackDiv.style.display = 'block';
        feedbackDiv.className = 'error';
        feedbackDiv.innerHTML = '‚ùå Your cart is empty. Please add items before checking out.';
        return;
    }
    
    if (!document.getElementById('name').value || !document.getElementById('email').value || !document.getElementById('address').value) {
        feedbackDiv.style.display = 'block';
        feedbackDiv.className = 'error';
        feedbackDiv.innerHTML = '‚ùå Please fill out all required details.';
        return;
    }
    
    // Check if Web3Forms key is set
    const accessKey = document.querySelector('input[name="access_key"]').value;
    if (accessKey === 'YOUR_WEB3FORMS_ACCESS_KEY_HERE') {
        feedbackDiv.style.display = 'block';
        feedbackDiv.className = 'error';
        feedbackDiv.innerHTML = '‚ùå Please set up your Web3Forms access key first!';
        return;
    }
    
    paymentButton.disabled = true;
    paymentButton.innerHTML = 'üí≥ Sending Order...';
    feedbackDiv.style.display = 'block';
    feedbackDiv.className = '';
    feedbackDiv.innerHTML = 'üîÑ Sending order to your email...';

    // Submit to Web3Forms
    const formData = new FormData(form);
    
    fetch('https://api.web3forms.com/submit', {
        method: 'POST',
        body: formData
    })
    .then(async response => {
        let json = await response.json();
        if (response.status === 200 && json.success) {
            // SUCCESS - Order sent to email
            const orderId = 'HIK-' + Date.now();
            const customerEmail = document.getElementById('email').value;
            
            feedbackDiv.className = 'success';
            feedbackDiv.innerHTML = `
                <i class="fas fa-check-circle"></i> 
                <strong>Order Sent Successfully!</strong><br>
                <small>Order #${orderId} has been sent to your email.</small>
                <div class="fallback-message" style="margin-top:15px;">
                    <strong>Order Details:</strong><br>
                    Total: AED ${totalAmount.toFixed(2)}<br>
                    Items: ${cart.length}<br>
                    Confirmation sent to: ${customerEmail}<br><br>
                    <strong>Thank you for your purchase!</strong>
                </div>
            `;

            // Save to localStorage as backup
            const orderData = {
                orderId: orderId,
                timestamp: new Date().toISOString(),
                customer: {
                    name: document.getElementById('name').value,
                    email: customerEmail,
                    phone: document.getElementById('phone').value,
                    address: document.getElementById('address').value,
                    city: document.getElementById('city').value,
                    country: document.getElementById('country').value,
                    zip: document.getElementById('zip').value
                },
                order: {
                    items: [...cart],
                    total: totalAmount
                }
            };
            
            const existingOrders = JSON.parse(localStorage.getItem('hik_orders') || '[]');
            existingOrders.push(orderData);
            localStorage.setItem('hik_orders', JSON.stringify(existingOrders));
            
            cart = [];
            renderCart();
            form.reset();
            
            showNotification('Order sent to your email!', 3000);
            
        } else {
            // Web3Forms error
            feedbackDiv.className = 'error';
            feedbackDiv.innerHTML = '‚ùå Failed to send order. Please try again.';
            paymentButton.disabled = false;
            paymentButton.innerHTML = 'Confirm Order & Pay AED <span id="paymentTotal">0.00</span>';
        }
    })
    .catch(error => {
        console.error('Error:', error);
        feedbackDiv.className = 'error';
        feedbackDiv.innerHTML = '‚ùå Network error. Please check your connection and try again.';
        paymentButton.disabled = false;
        paymentButton.innerHTML = 'Confirm Order & Pay AED <span id="paymentTotal">0.00</span>';
    });
});

// ... (rest of your AI assistant code remains the same) ...
</script>
</body>
</html>
